<?php
function normalize($text) {
	$filters = [
		/* [،؛].. -> [،؛] */
		["/([،؛])+/u", "$1"],
		
		/* [،؛.!؟:] -> [،؛.!؟:]\s */
		["/ *([،؛\.!؟:]) */u", "$1 "],

		/* !\s! -> !! */
		["/(! +){2}/u", "!!"],

		/* ?\s? -> ?? */
		["/(؟ +){2}/u", "؟؟"],

		/* :\s: -> :: */
		["/(: +){2}/u", "::"],
		
		/* .\s. -> .. */
		["/(\. +){2}/u", ".."],

		/* .\w -> . \w */
		["/\.(\w)/u", ". $1"],

		/* .... -> ... . */
		["/(\.{3,})\./u", "$1 ."],

		/* [،؛!؟:]\w -> [،؛!؟:]\s\w */
		["/ *([،؛!؟:])(\w)/u", "$1 $2"],
		
		/* (( -> « */
		["/\(( *\()+ */u", "«"],

		/* )) -> » */
		["/ *\)( *\))+/u", "»"],

		/* << -> « */
		["/<( *<)+ */u", "«"],

		/* >> -> » */
		["/ *>( *>)+/u", "»"],

		/* :« -> : « */
		["/: *«/u", ": «"],

		/* «\s -> « */
		["/« +/u", "«"],

		/* \s» -> » */
		["/ +»/u", "»"],

		/* [0-9][.،!؟؛]\s[0-9] -> [0-9][.،!؟؛][0-9] */
		["/([0-9])([.،!؟؛]) +([0-9])/u", "$1$2$3"],

		/* [٠-٩][.،!؟؛]\s[٠-٩] -> [٠-٩][.،!؟؛][٠-٩] */
		["/([٠-٩])([.،!؟؛]) +([٠-٩])/u", "$1$2$3"],

		/* [۰-۹][.،!؟؛]\s[۰-۹] -> [۰-۹][.،!؟؛][۰-۹] */
		["/([۰-۹])([.،!؟؛]) +([۰-۹])/u", "$1$2$3"],

		/* \w\s..\w -> \w\s\w */
		["/(\w) {2,}(\w)/u", "$1 $2"],

		/* \s..$ -> $ */
		["/ +$/um", ""],

		/* ^\s.. -> ^ */
		["/^ +/um", ""],
	];
	
	/* Apply Filters */
	foreach($filters as $filter)
		$text = preg_replace($filter[0], $filter[1], $text);
	
	/* Trim Text */
	$text = trim($text);

	return $text;
}
?>
